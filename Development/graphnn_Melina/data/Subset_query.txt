/* THE FIRST TWO LINES OPEN THE DATABASES IN sqlite3 COMMAND LINE*/
ATTACH 'qm9.db' as q;
ATTACH 'subset_half.db' as sub;

/* QUERY TO CREATE THE SUBSET: CHANGE ONLY THE CRITERIA TO SUBSET*/
CREATE TABLE sub.systems (
    id INTEGER PRIMARY KEY AUTOINCREMENT,  -- ID's, timestamps and user name
    unique_id TEXT UNIQUE,
    ctime REAL,
    mtime REAL,
    username TEXT,
    numbers BLOB,  -- stuff that defines an Atoms object
    positions BLOB,
    cell BLOB,
    pbc INTEGER,
    initial_magmoms BLOB,
    initial_charges BLOB,
    masses BLOB,
    tags BLOB,
    momenta BLOB,
    constraints TEXT,  -- constraints and calculator
    calculator TEXT,
    calculator_parameters TEXT,
    energy REAL,  -- calculated properties
    free_energy REAL,
    forces BLOB,
    stress BLOB,
    dipole BLOB,
    magmoms BLOB,
    magmom REAL,
    charges BLOB,
    key_value_pairs TEXT,  -- key-value pairs and data as json
    data BLOB,
    natoms INTEGER,  -- stuff for making queries faster
    fmax REAL,
    smax REAL,
    volume REAL,
    mass REAL,
    charge REAL);
CREATE TABLE sub.sqlite_sequence(name,seq);
CREATE TABLE sub.species (
    Z INTEGER,
    n INTEGER,
    id INTEGER,
    FOREIGN KEY (id) REFERENCES systems(id));
CREATE TABLE sub.keys (
    key TEXT,
    id INTEGER,
    FOREIGN KEY (id) REFERENCES systems(id));
CREATE TABLE sub.text_key_values (
    key TEXT,
    value TEXT,
    id INTEGER,
    FOREIGN KEY (id) REFERENCES systems(id));
CREATE TABLE sub.number_key_values (
    key TEXT,
    value REAL,
    id INTEGER,
    FOREIGN KEY (id) REFERENCES systems(id));
CREATE TABLE sub.information (
    name TEXT,
    value TEXT);
CREATE INDEX sub.unique_id_index ON systems(unique_id);
CREATE INDEX sub.ctime_index ON systems(ctime);
CREATE INDEX sub.username_index ON systems(username);
CREATE INDEX sub.calculator_index ON systems(calculator);
CREATE INDEX sub.species_index ON species(Z);
CREATE INDEX sub.key_index ON keys(key);
CREATE INDEX sub.text_index ON text_key_values(key);
CREATE INDEX sub.number_index ON number_key_values(key);

INSERT INTO sub.systems SELECT * FROM q.systems WHERE (id<66943);   /* CHANGE THE SUBSETTING CRITERIA HERE*/
INSERT INTO sub.species SELECT * FROM q.species WHERE id IN (SELECT id FROM sub.systems);
INSERT INTO sub.keys SELECT * FROM q.keys WHERE id IN (SELECT id FROM sub.systems);
INSERT INTO sub.text_key_values SELECT * FROM q.text_key_values WHERE id IN (SELECT id FROM sub.systems);
INSERT INTO sub.number_key_values SELECT * FROM q.number_key_values WHERE id IN (SELECT id FROM sub.systems);
INSERT INTO sub.information SELECT * FROM q.information;